<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a73e8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Relief Allocation App</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="image/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="image/favicon-32x32.png">
    <link rel="icon" type="image/x-icon" href="image/favicon.ico">

    <!-- For Apple devices -->
    <link rel="apple-touch-icon" href="image/apple-touch-icon.png">

    <!-- For Android/Chrome -->
    <link rel="icon" type="image/png" sizes="192x192" href="image/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="image/android-chrome-512x512.png">
    <style>
    /* Professional table styling */
    .table-container table, .enhanced-residents-table table, #goodsTotalsTable, #adminDeliveriesTable, #barangayTable {
        border-collapse: collapse;
        width: 100%;
    }
    .table-container th, .table-container td,
    .enhanced-residents-table th, .enhanced-residents-table td,
    #goodsTotalsTable th, #goodsTotalsTable td,
    #adminDeliveriesTable th, #adminDeliveriesTable td,
    #barangayTable th, #barangayTable td {
        border: 1px solid #d1d5db;
        padding: 8px 10px;
        font-size: 14px;
    }
    .table-container th, .enhanced-residents-table th, #goodsTotalsTable th, #adminDeliveriesTable th, #barangayTable th {
        background: #f3f4f6;
        color: #1f2937;
        text-align: left;
    }
    .table-container tbody tr:nth-child(even), .enhanced-residents-table tbody tr:nth-child(even) {
        background: #fafafa;
    }

    /* New inventory management styles */
    .section-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .action-button {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 8px 12px;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
        text-decoration: none;
        color: #334155;
    }
    
    .action-button:hover {
        background: #e2e8f0;
        border-color: #cbd5e1;
        transform: translateY(-1px);
    }
    
    .action-button.primary-btn {
        background: #3b82f6;
        color: white;
        border-color: #2563eb;
    }
    
    .action-button.primary-btn:hover {
        background: #2563eb;
        border-color: #1d4ed8;
    }
    
    .filter-controls {
        padding: 12px;
        background: #f8fafc;
        border-radius: 6px;
        border: 1px solid #e2e8f0;
    }
    
    .filter-controls input, .filter-controls select {
        padding: 6px 8px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 14px;
    }
    
    .status-badge {
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    .status-received { background: #dcfce7; color: #166534; }
    .status-delivered { background: #dbeafe; color: #1e40af; }
    .status-pending { background: #fef3c7; color: #92400e; }
    
    .receive-btn {
        background: #10b981;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }
    
    .receive-btn:hover {
        background: #059669;
    }
    
    .status-btn {
        background: #6b7280;
        color: white;
        border: none;
        padding: 4px 12px;
        border-radius: 4px;
        cursor: not-allowed;
        font-size: 12px;
        opacity: 0.7;
    }
    
    .action-button:disabled, .receive-btn:disabled, button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    
    .action-button:disabled:hover, .receive-btn:disabled:hover {
        transform: none;
        background: #6b7280;
    }
    
    /* Enhanced delivery details styles */
    .details-cell {
        min-width: 300px;
        max-width: 400px;
        vertical-align: top;
    }
    
    /* 🔥 NEW: Session status indicator styles */
    .session-status {
        margin-top: 12px;
        padding: 8px 12px;
        background: rgba(0, 0, 0, 0.05);
        border-radius: 6px;
        border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .session-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
    }
    
    .session-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
        animation: pulse 2s infinite;
    }
    
    .session-dot.active {
        background: #10b981; /* Green for active */
    }
    
    .session-dot.expired {
        background: #f59e0b; /* Orange for expired */
        animation: none;
    }
    
    .session-dot.invalid {
        background: #ef4444; /* Red for invalid */
        animation: none;
    }
    
    .session-text {
        font-size: 12px;
        font-weight: 500;
        color: #374151;
    }
    
    .session-info {
        font-size: 10px;
        color: #6b7280;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    
    /* Hide session status on mobile */
    @media (max-width: 768px) {
        .session-status {
            display: none !important;
        }
    }
    
    .details-preview {
        padding: 4px 0;
    }
    
    .details-text, .goods-preview {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 4px;
        font-size: 13px;
        line-height: 1.4;
    }
    
    .details-text {
        color: #374151;
        font-weight: 500;
        justify-content: space-between;
        width: 100%;
    }
    
    .expand-indicator {
        color: #6b7280;
        font-size: 10px;
        transition: transform 0.2s ease;
        margin-left: auto;
    }
    
    .goods-preview {
        color: #6b7280;
        font-size: 12px;
        padding-left: 18px;
    }
    
    .details-expanded-row {
        background: #f8fafc;
        border-left: 3px solid #0ea5e9;
    }
    
    .details-expanded-row.hidden {
        display: none;
    }
    
    .expanded-content {
        padding: 16px;
        background: #f8fafc;
        border-radius: 6px;
        margin: 8px;
    }
    
    .full-details h4, .full-goods h4 {
        margin: 0 0 8px 0;
        font-size: 14px;
        font-weight: 600;
        color: #1f2937;
    }
    
    .full-details p {
        margin: 0;
        color: #374151;
        line-height: 1.5;
        font-size: 13px;
    }
    
    .goods-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
    }
    
    .goods-item {
        background: #e0f2fe;
        color: #0369a1;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        white-space: nowrap;
    }
    
    .no-goods {
        color: #9ca3af;
        font-style: italic;
        margin: 0;
        font-size: 12px;
    }
    
    .details-cell:hover .details-preview {
        background: #f1f5f9;
        border-radius: 4px;
        padding: 6px;
    }
    
    .row-expanded {
        background-color: #f0f9ff !important;
        border-left: 3px solid #0ea5e9;
    }
    
    .row-expanded .details-preview {
        background: #e0f2fe;
        border-radius: 4px;
        padding: 6px;
    }
    
    /* Status badges improvements */
    .status-transit { background: #ddd6fe; color: #7c3aed; }
    
    /* Barangay delivery details now use the same expandable design as admin */
    
    /* Barangay action buttons */
    .barangay-action-buttons {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }
    
    .print-receipt-btn {
        background: #059669;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        display: flex;
        align-items: center;
        gap: 3px;
        transition: background-color 0.2s;
    }
    
    .print-receipt-btn:hover {
        background: #047857;
    }
    
    .print-receipt-btn .btn-icon {
        font-size: 12px;
    }
    
    .print-receipt-btn .btn-text {
        font-size: 10px;
    }
    
    /* Responsive improvements for delivery table */
    @media (max-width: 768px) {
        .details-cell {
            min-width: 200px;
            max-width: 300px;
        }
        
        .expanded-content {
            padding: 12px;
            margin: 4px;
        }
        
        .goods-grid {
            flex-direction: column;
            gap: 4px;
        }
    }
    
    /* Enhanced Message Modal Styles */
    .message-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .message-modal:not(.hidden) {
        opacity: 1;
        visibility: visible;
    }

    .message-modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(2px);
        cursor: pointer;
    }

    .message-modal-content {
        position: relative;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        max-width: 480px;
        width: 90%;
        margin: 0 20px;
        transform: scale(0.95) translateY(20px);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .message-modal:not(.hidden) .message-modal-content {
        transform: scale(1) translateY(0);
    }

    .message-modal-header {
        padding: 20px 24px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .message-modal-header h3 {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
    }

    .message-modal-close {
        background: none;
        border: none;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        color: #6b7280;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .message-modal-close:hover {
        background: #f3f4f6;
        color: #374151;
        transform: scale(1.1);
    }

    .message-modal-close .material-icons {
        font-size: 20px;
    }

    .message-modal-body {
        padding: 16px 24px;
        display: flex;
        align-items: flex-start;
        gap: 16px;
    }

    .message-icon {
        flex-shrink: 0;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 600;
    }

    .message-icon.success {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .message-icon.error {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
    }

    .message-icon.warning {
        background: linear-gradient(135deg, #f59e0b, #d97706);
        color: white;
    }

    .message-icon.info {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }

    .message-text {
        flex: 1;
        color: #374151;
        font-size: 1rem;
        line-height: 1.6;
        margin-top: 8px;
    }

    .message-modal-footer {
        padding: 0 24px 24px;
        display: flex;
        justify-content: flex-end;
    }

    .message-ok-btn {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        font-size: 0.95rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    }

    .message-ok-btn:hover {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
    }

    .message-ok-btn:active {
        transform: translateY(0);
    }

    .message-ok-btn .material-icons {
        font-size: 18px;
    }

    /* Success variant */
    .message-modal.success .message-ok-btn {
        background: linear-gradient(135deg, #10b981, #059669);
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
    }

    .message-modal.success .message-ok-btn:hover {
        background: linear-gradient(135deg, #059669, #047857);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
    }

    /* Error variant */
    .message-modal.error .message-ok-btn {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
    }

    .message-modal.error .message-ok-btn:hover {
        background: linear-gradient(135deg, #dc2626, #b91c1c);
        box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
    }

    /* Animations */
    @keyframes modalSlideIn {
        0% {
            opacity: 0;
            transform: scale(0.9) translateY(30px);
        }
        100% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
    }

    @keyframes modalSlideOut {
        0% {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        100% {
            opacity: 0;
            transform: scale(0.9) translateY(30px);
        }
    }

    .message-modal.show .message-modal-content {
        animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .message-modal.hide .message-modal-content {
        animation: modalSlideOut 0.3s ease-out;
    }

    /* Responsive design */
    @media (max-width: 480px) {
        .message-modal-content {
            margin: 0 16px;
            border-radius: 12px;
        }
        
        .message-modal-header,
        .message-modal-body,
        .message-modal-footer {
            padding-left: 20px;
            padding-right: 20px;
        }
        
        .message-icon {
            width: 40px;
            height: 40px;
            font-size: 20px;
        }
    }

    /* Print-friendly styles */
    @media print {
        body { color: #000; }
        .sidebar, .mobile-header, .section-actions, .action-cell, .action-button, .delete-btn, .edit-btn, .close, .mobile-nav-toggle,
        .filter-controls, .search-filter-section, .export-btn, .print-btn, .btn, .buttons-html5, .buttons-print, .message-modal { display: none !important; }
        .modal { position: static !important; }
        .modal-content { box-shadow: none !important; border: none !important; }
        table { page-break-inside: auto; }
        tr { page-break-inside: avoid; page-break-after: auto; }
        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        @page { margin: 12mm; }
    }

    /* Admin Scheduled Deliveries: professionalize table content */
    .deliveries-overview-card .th-icon { display: none; }
    #adminDeliveriesTable {
        table-layout: fixed;
    }
    #adminDeliveriesTable th, #adminDeliveriesTable td {
        white-space: normal;
        overflow-wrap: anywhere;
        word-break: break-word;
        vertical-align: top;
    }
    /* Compact, professional header row */
    #adminDeliveriesTable th {
        padding: 6px 10px;
        line-height: 1.2;
        vertical-align: middle;
    }
    #adminDeliveriesTable th > * { margin: 0; }

    /* Column widths (slightly reduce Items to give Details more space) */
    #adminDeliveriesTable th:nth-child(1),
    #adminDeliveriesTable td:nth-child(1) { width: 14%; }
    #adminDeliveriesTable th:nth-child(2),
    #adminDeliveriesTable td:nth-child(2) { width: 14%; }
    #adminDeliveriesTable th:nth-child(3),
    #adminDeliveriesTable td:nth-child(3) { width: 18%; }
    #adminDeliveriesTable th:nth-child(4),
    #adminDeliveriesTable td:nth-child(4) { width: 32%; }
    #adminDeliveriesTable th:nth-child(5),
    #adminDeliveriesTable td:nth-child(5) { width: 10%; }
    #adminDeliveriesTable th:nth-child(6),
    #adminDeliveriesTable td:nth-child(6) { width: 12%; }
    /* Tighter, readable typography inside the admin deliveries table */
    #adminDeliveriesTable { font-size: 13px; }
    #adminDeliveriesTable .items-cell .items-content,
    #adminDeliveriesTable .details-text {
        font-size: 13px;
        line-height: 1.4;
    }
    #adminDeliveriesTable .items-cell .items-content,
    #adminDeliveriesTable .details-text {
        white-space: normal;
        word-break: break-word;
        overflow: visible;
    }
    /* Ensure details column shows full text without truncation */
    #adminDeliveriesTable .details-text { overflow: visible; }
    /* Keep action icons visible but align neatly */
    #adminDeliveriesTable .action-cell {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
    }
    #adminDeliveriesTable .action-cell .print-btn,
    #adminDeliveriesTable .action-cell .delete-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        width: 100%;
        min-height: 32px;
        padding: 6px 10px;
        font-size: 12px;
        line-height: 1.2;
        white-space: nowrap;
        writing-mode: horizontal-tb;
        text-orientation: mixed;
        border-radius: 6px;
    }
    #adminDeliveriesTable .action-cell .print-btn .btn-text,
    #adminDeliveriesTable .action-cell .delete-btn .btn-text {
        writing-mode: horizontal-tb;
        letter-spacing: normal;
    }

    /* Barangay Delivery Status: remove header emojis and ensure clean wrapping */
    #deliveryStatus .th-icon { display: none; }
    #barangayDeliveriesTable { table-layout: fixed; font-size: 13px; }
    #barangayDeliveriesTable th, #barangayDeliveriesTable td {
        white-space: normal;
        overflow-wrap: anywhere;
        word-break: break-word;
        vertical-align: top;
        overflow: visible;
        text-overflow: clip;
    }
    #barangayDeliveriesTable th { padding: 6px 10px; line-height: 1.2; vertical-align: middle; }
    #barangayDeliveriesTable th > * { margin: 0; }
    /* Column widths: give Details room */
    #barangayDeliveriesTable th:nth-child(1),
    #barangayDeliveriesTable td:nth-child(1) { width: 20%; }
    #barangayDeliveriesTable th:nth-child(2),
    #barangayDeliveriesTable td:nth-child(2) { width: 22%; }
    #barangayDeliveriesTable th:nth-child(3),
    #barangayDeliveriesTable td:nth-child(3) { width: 38%; }
    #barangayDeliveriesTable th:nth-child(4),
    #barangayDeliveriesTable td:nth-child(4) { width: 10%; }
    #barangayDeliveriesTable th:nth-child(5),
    #barangayDeliveriesTable td:nth-child(5) { width: 10%; }
    /* Items and details text */
    #barangayDeliveriesTable .items-content,
    #barangayDeliveriesTable .details-content,
    #barangayDeliveriesTable .details-text {
        font-size: 13px;
        line-height: 1.4;
        overflow: visible !important;
        text-overflow: clip !important;
        white-space: pre-line !important; /* preserve line breaks */
        word-break: break-word !important;
        display: block;
        max-height: none;
        -webkit-line-clamp: unset;
        line-clamp: unset;
        -webkit-box-orient: unset;
    }
    /* Ensure explicit line-break display for items */
    #barangayDeliveriesTable .items-content br { display: block; }

    /* Barangay Actions column: stack Received above Print, consistent sizing */
    #barangayDeliveriesTable .barangay-action-buttons {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
    }

    /* Delivery History (Barangay modal): remove helper search section */
    #historySearchSection { display: none; }
    /* Delivery History table: prevent truncation and ensure clean wrapping */
    #deliveryHistoryTable { table-layout: fixed; font-size: 12.5px; }
    #deliveryHistoryTable th, #deliveryHistoryTable td {
        white-space: normal;
        overflow-wrap: anywhere;
        word-break: break-word;
        vertical-align: top;
        overflow: visible;
        text-overflow: clip;
    }
    #deliveryHistoryTable .items-content,
    #deliveryHistoryTable .details-content { 
        white-space: pre-line; 
        display: block; 
        overflow: visible; 
        text-overflow: clip; 
        line-height: 1.4; 
        font-size: 12.5px;
    }

    /* Barangay → Resident Management: make headers/body wrap cleanly and prevent overflow */
    #residentsTable { table-layout: fixed; font-size: 12.5px; }
    #residentsTable th, #residentsTable td {
        white-space: normal;
        overflow-wrap: anywhere;
        word-break: break-word;
        vertical-align: top;
        overflow: visible;
        text-overflow: clip;
        padding: 6px 8px;
    }
    #residentsTable th { line-height: 1.2; font-size: 12px; text-align: left; }
    #residentsTable td { font-size: 12.5px; }
    #residentsTable th > * { margin: 0; }
    /* Suggested column widths for readability */
    #residentsTable th:nth-child(1),  #residentsTable td:nth-child(1)  { width: 16%; } /* Name */
    #residentsTable th:nth-child(2),  #residentsTable td:nth-child(2)  { width: 6%; }  /* Age */
    #residentsTable th:nth-child(3),  #residentsTable td:nth-child(3)  { width: 10%; } /* Address Zone */
    #residentsTable th:nth-child(4),  #residentsTable td:nth-child(4)  { width: 9%; }  /* Household No */
    #residentsTable th:nth-child(5),  #residentsTable td:nth-child(5)  { width: 7%; }  /* Gender */
    #residentsTable th:nth-child(6),  #residentsTable td:nth-child(6)  { width: 10%; } /* Household Status */
    #residentsTable th:nth-child(7),  #residentsTable td:nth-child(7)  { width: 9%; }  /* House Material */
    #residentsTable th:nth-child(8),  #residentsTable td:nth-child(8)  { width: 7%; }  /* Terrain */
    #residentsTable th:nth-child(9),  #residentsTable td:nth-child(9)  { width: 9%; }  /* Family Members */
    #residentsTable th:nth-child(10), #residentsTable td:nth-child(10) { width: 9%; }  /* Monthly Income */
    #residentsTable th:nth-child(11), #residentsTable td:nth-child(11) { width: 9%; }  /* Aid History */
    #residentsTable th:nth-child(12), #residentsTable td:nth-child(12) { width: 10%; } /* Remarks */
    #residentsTable th:nth-child(13), #residentsTable td:nth-child(13) { width: 9%; }  /* Evacuee History */
    #residentsTable th:nth-child(14), #residentsTable td:nth-child(14) { width: 8%; }  /* Action */

    /* Action column: vertical, consistent buttons */
    #residentsTable td:nth-child(14) {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        min-width: 110px; /* ensure enough space for labels */
        padding-top: 6px;
        padding-bottom: 6px;
    }
    #residentsTable td:nth-child(14) .edit-btn,
    #residentsTable td:nth-child(14) .delete-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        box-sizing: border-box;
        height: 34px; /* consistent height */
        padding: 6px 12px; /* balanced padding */
        font-size: 12px; /* consistent font size */
        line-height: 1; /* prevent text wrap */
        white-space: nowrap;
        border-radius: 6px;
    }

    /* Resident Management: place search under export buttons */
    #barangayResidentSearchSection {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
    }
    #barangayResidentSearchSection .dt-buttons {
        order: 0;
        display: inline-flex !important;
        gap: 8px !important;
        flex-wrap: wrap !important;
        margin: 0 0 4px 0 !important;
    }
    #barangayResidentSearchSection .search-section {
        order: 1;
        width: 100%;
    }
    #barangayResidentSearchSection .search-info { margin-bottom: 6px; }
    #barangayResidentSearchSection .search-box input {
        width: 100%;
        max-width: 520px;
    }

    /* Global Responsive Enhancements */
    .table-container table,
    .enhanced-residents-table table,
    #goodsTotalsTable,
    #adminDeliveriesTable,
    #barangayDeliveriesTable,
    #residentsTable,
    #deliveryHistoryTable { width: 100%; table-layout: fixed; }
    .table-container th, .table-container td,
    .enhanced-residents-table th, .enhanced-residents-table td,
    #goodsTotalsTable th, #goodsTotalsTable td,
    #adminDeliveriesTable th, #adminDeliveriesTable td,
    #barangayDeliveriesTable th, #barangayDeliveriesTable td,
    #residentsTable th, #residentsTable td,
    #deliveryHistoryTable th, #deliveryHistoryTable td { white-space: normal; overflow-wrap: anywhere; word-break: break-word; }

    /* Touch-friendly buttons */
    @media (max-width: 768px) {
        button,
        .action-button,
        .receive-btn,
        .status-btn,
        .print-btn,
        .print-receipt-btn,
        .delete-btn,
        .submit-btn { min-height: 44px; padding: 10px 14px; font-size: 14px; }
        .dt-buttons button { min-height: 40px !important; padding: 8px 12px !important; font-size: 13px !important; }
    }

    /* Forms: full-width inputs on small screens */
    @media (max-width: 768px) {
        .enhanced-form .form-row { display: block; }
        .enhanced-form .form-group { width: 100% !important; }
        .enhanced-form input, .enhanced-form select, .enhanced-form textarea { width: 100%; }
    }

    /* Tables: typography scaling */
    @media (max-width: 1024px) {
        #adminDeliveriesTable,
        #barangayDeliveriesTable,
        #residentsTable,
        #deliveryHistoryTable { font-size: 12.5px; }
        #adminDeliveriesTable th, #barangayDeliveriesTable th, #residentsTable th, #deliveryHistoryTable th { padding: 6px 8px; }
    }
    @media (max-width: 768px) {
        #adminDeliveriesTable,
        #barangayDeliveriesTable,
        #residentsTable,
        #deliveryHistoryTable { font-size: 12px; }
        #adminDeliveriesTable th, #barangayDeliveriesTable th, #residentsTable th, #deliveryHistoryTable th { padding: 5px 6px; }
    }

    /* Modals & Popups (SweetAlert2 + custom) */
    .swal2-popup { border-radius: 14px; }
    @media (max-width: 480px) {
        .message-modal-content { width: 94vw; }
        .message-modal-header h3 { font-size: 1.1rem; }
        .message-text { font-size: 0.95rem; }
        .swal2-popup { width: 90vw !important; padding: 1.25rem !important; }
        .swal2-title { font-size: 1.1rem !important; }
        .swal2-html-container { font-size: 0.95rem !important; }
        .swal2-actions button { min-width: 88px; }
    }

    /* Navigation tweaks */
    @media (max-width: 768px) {
        .sidebar { width: 75vw; }
        .mobile-header .mobile-menu-btn { padding: 10px; }
        .card { padding: 12px; }
        .card .card-header h3 { font-size: 1rem; }
        .section-header h2 { font-size: 1.1rem; }
    }
    #barangayDeliveriesTable .barangay-action-buttons .receive-btn,
    #barangayDeliveriesTable .barangay-action-buttons .status-btn,
    #barangayDeliveriesTable .barangay-action-buttons .print-receipt-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        width: 100%;
        min-height: 32px;
        padding: 6px 10px;
        font-size: 11px; /* match print button size */
        line-height: 1.2;
        white-space: nowrap; /* prevent line breaks like Receiv\ned */
        writing-mode: horizontal-tb;
        text-orientation: mixed;
        border-radius: 6px;
    }
    #barangayDeliveriesTable .barangay-action-buttons .receive-btn .btn-text,
    #barangayDeliveriesTable .barangay-action-buttons .status-btn .btn-text,
    #barangayDeliveriesTable .barangay-action-buttons .print-receipt-btn .btn-text {
        font-size: 11px;
        white-space: nowrap;
    }
    
    /* Residents Modal Export Buttons */
    .export-buttons-desktop {
        display: flex;
        gap: 6px;
        align-items: center;
        margin-bottom: 16px;
        padding: 0;
        justify-content: flex-start;
        flex-wrap: nowrap;
    }
    
    .export-buttons-desktop .export-btn {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
        transition: all 0.2s ease;
        color: white;
        min-height: 32px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        white-space: nowrap;
        min-width: auto;
        width: auto;
        flex-shrink: 0;
    }
    
    #exportResidentsExcelBtn {
        background: #217346;
    }
    
    #exportResidentsExcelBtn:hover {
        background: #1a5a37;
        transform: translateY(-1px);
    }
    
    #exportResidentsPDFBtn {
        background: #dc2626;
    }
    
    #exportResidentsPDFBtn:hover {
        background: #b91c1c;
        transform: translateY(-1px);
    }
    
    #printResidentsBtn {
        background: #7c3aed;
    }
    
    #printResidentsBtn:hover {
        background: #6d28d9;
        transform: translateY(-1px);
    }
    
    .export-section.mobile-export {
        margin-bottom: 16px;
        display: none; /* Hidden by default, shown when DataTables buttons are moved here */
    }
    
    .export-section.mobile-export .dt-buttons {
        display: flex !important;
        gap: 8px !important;
        flex-wrap: wrap !important;
    }
    
    /* Hide desktop export buttons on mobile, show DataTables buttons */
    @media (max-width: 768px) {
        .export-buttons-desktop {
            display: none !important;
        }
        
        .export-section.mobile-export {
            display: block !important;
        }
    }
    
    /* Ensure desktop export buttons work on larger screens */
    @media (min-width: 769px) {
        .export-buttons-desktop {
            display: flex !important;
        }
        
        .export-section.mobile-export {
            display: none !important;
        }
    }
    </style>
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a class="skip-link" href="#main">Skip to main content</a>

    <!-- ✅ Enhanced Success and Error Message Modal -->
    <div id="messageModal" class="message-modal hidden">
        <div class="message-modal-overlay" onclick="closeMessageModal()"></div>
        <div class="message-modal-content">
            <div class="message-modal-header">
                <h3 id="messageTitle">Message</h3>
                <button class="message-modal-close" onclick="closeMessageModal()" aria-label="Close message">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="message-modal-body">
                <div id="messageIcon" class="message-icon"></div>
                <div id="messageText" class="message-text">Message content</div>
            </div>
            <div class="message-modal-footer">
                <button id="messageOkBtn" class="message-ok-btn" onclick="closeMessageModal()">
                    <span class="material-icons">check</span>
                    <span>OK</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ✅ Legacy Success and Error Messages (for compatibility) -->
    <div class="center-message">
        <div id="successMessage" class="hidden text-green-500 font-bold p-2"></div>
        <div id="errorMessage" class="hidden text-red-500 font-bold p-2"></div>
    </div>

    <!-- Login Form -->
    <div class="login-container" id="loginContainer">
        <!-- Back Button -->
        <button type="button"
        onclick="window.location.href='index.html'"
        aria-label="Go back"
        class="back-button"
        onmouseenter="this.style.background='#e5e7eb'; this.style.transform='scale(1.06)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.15)';"
        onmouseleave="this.style.background='rgba(17,24,39,0.08)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.12)';">
            <span class="material-icons">arrow_back</span>
        </button>
        
        <div class="login-box">
            <h1>ReliefPoint</h1>
            <form id="loginForm">
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" autocomplete="username" required>
                </div>
                <div class="input-group password-group">
                    <label for="password">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" name="password" autocomplete="current-password" required>
                        <span class="material-icons" id="togglePassword">visibility_off</span>
                    </div>
                </div>
                <button type="submit">Login</button>
                <button type="button" id="requestAccountBtn" class="secondary-button">Request Account</button>
            </form>          
        </div>
    </div>

    <!-- ✅ Request Account Modal -->
    <div id="requestAccountModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Request Account</h2>
            </div>
            <form id="requestAccountForm">
                <div class="input-group">
                    <label for="requestUsername">Barangay Name</label>
                    <input type="text" id="requestUsername" name="requestUsername" required>
                </div>
                <div class="input-group">
                    <label for="requestEmail">Email</label>
                    <input type="email" id="requestEmail" name="requestEmail" required>
                </div>
                <div class="input-group">
                    <label for="requestContact">Contact</label>
                    <input type="text" id="requestContact" name="requestContact" required>
                </div>
                <div class="input-group">
                    <label for="requestMessage">Message</label>
                    <textarea id="requestMessage" name="requestMessage" required></textarea>
                </div>
                <div class="button-group">
                    <button type="submit">Submit Request</button>
                    <button id="cancelRequestBtn" type="button" class="secondary-button">Cancel</button>
                </div>
            </form>            
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container hidden" id="dashboardContainer">
        <!-- Mobile sidebar overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

        <nav class="sidebar" role="navigation" aria-label="Dashboard navigation">
            <div class="sidebar-header">
                <h2 id="userRole">Welcome</h2>
                <!-- 🔥 NEW: Session Status Indicator -->
                <div id="sessionStatus" class="session-status" style="display: none;">
                    <div class="session-indicator">
                        <span class="session-dot active" id="sessionDot"></span>
                        <span class="session-text" id="sessionText">Active Session</span>
                    </div>
                    <div class="session-info" id="sessionInfo">
                        <small>Login: <span id="sessionTime">--</span></small>
                    </div>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li class="mswd-only"><a href="#" onclick="showSection('barangayManagement')">Manage Barangays</a></li>
                <li class="mswd-only"><a href="#" onclick="showSection('accountRequests')">Account Requests</a></li>
                <li class="mswd-only"><a href="#" onclick="showSection('deliveryScheduling')">Delivery Scheduling</a></li>
                <li class="mswd-only"><a href="#" onclick="showSection('trackGoods')">Track Relief Goods</a></li>
                <li class="barangay-only"><a href="#" onclick="showSection('residentManagement')">Manage Residents</a></li>
                <li class="barangay-only"><a href="#" onclick="showSection('deliveryStatus')">Delivery Status</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('statistics')">Priority Statistics</a></li>
                <li><a href="#" onclick="showChangePassword()">Change Password</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </nav>

        <main class="main-content" id="main" role="main">
            <!-- Mobile Header -->
            <div class="mobile-header">
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" aria-label="Open menu">
                    <div class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
                <h1 class="mobile-title">Dashboard</h1>
            </div>

            <!-- MSWD: Track Relief Goods Section -->
            <div id="trackGoods" class="section hidden">
                <div class="section-header">
                    <h2>📦 Track Relief Goods</h2>
                    <div class="section-actions">
                        <button id="historyBtn" class="action-button">
                            <span class="material-icons">history</span>
                            <span class="btn-text">History</span>
                        </button>
                        <button id="newBatchBtn" class="action-button primary-btn">
                            <span class="material-icons">refresh</span>
                            <span class="btn-text">New Relief Operation</span>
                        </button>
                        <button id="summaryBtn" class="action-button">
                            <span class="material-icons">summarize</span>
                            <span class="btn-text">Summary Report</span>
                        </button>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>Update Inventory</h3>
                        <p>Add received goods to inventory. Totals update automatically.</p>
                    </div>
                    <form id="goodsForm" class="enhanced-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Rice (sacks)</label>
                                <input type="number" id="invRice" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Biscuits (boxes)</label>
                                <input type="number" id="invBiscuits" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Canned Goods (boxes)</label>
                                <input type="number" id="invCanned" min="0" value="0">
                            </div>
                            <div class="form-group">
                                <label>Shirts (packs)</label>
                                <input type="number" id="invShirts" min="0" value="0">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="btn-icon">➕</span>
                                <span>Add to Inventory</span>
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Current Totals</h3>
                    </div>
                    <div class="table-container mobile-table">
                        <table id="goodsTotalsTable">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Rice (sacks)</td><td id="totalRice">0</td></tr>
                                <tr><td>Biscuits (boxes)</td><td id="totalBiscuits">0</td></tr>
                                <tr><td>Canned Goods (boxes)</td><td id="totalCanned">0</td></tr>
                                <tr><td>Shirts (packs)</td><td id="totalShirts">0</td></tr>
                                <tr><td><strong>Overall Total</strong></td><td id="totalOverall">0</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Inventory History Modal -->
                <div id="historyModal" class="modal hidden">
                    <div class="modal-content" style="max-width: 960px;">
                        <div class="modal-header">
                            <h2>Inventory History</h2>
                            <span class="close" onclick="document.getElementById('historyModal').classList.add('hidden')">&times;</span>
                        </div>
                        <div class="filter-controls" style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                            <label>Batch:</label>
                            <select id="historyBatchSelect"></select>
                            <input id="historySearch" placeholder="Search item/user/txn" />
                        </div>
                        <div class="table-container mobile-table">
                            <table id="inventoryHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>Type</th>
                                        <th>Item</th>
                                        <th>Qty</th>
                                        <th>User</th>
                                        <th>Transaction ID</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryHistoryBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>

            <div id="accountRequests" class="section hidden">
                <div class="section-header">
                    <h2>Account Requests</h2>
                </div>
                <div class="card">
                    <h3>Pending Requests</h3>
                    <div class="table-container mobile-table">
                        <table id="requestsTable">
                            <thead>
                                <tr>
                                    <th>Barangay Name</th>
                                    <th>Email</th>
                                    <th>Contact</th>
                                    <th>Message</th>
                                    <th>Date Requested</th>
                                    <th class="no-export">Action</th>
                                </tr>
                            </thead>
                            <tbody id="requestsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Account Approval Modal with Terrain Selection -->
            <div id="approveAccountModal" class="modal hidden">
                <div class="modal-content add-resident-modal">
                    <div class="modal-header">
                        <h2>Approve Barangay Account</h2>
                        <span class="close" onclick="closeApproveModal()">&times;</span>
                    </div>
                    <form id="approveAccountForm">
                        <input type="hidden" id="approveRequestId">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Barangay Name:</label>
                                <input type="text" id="approveBarangayName" readonly style="background: #f9fafb;">
                            </div>
                            <div class="form-group">
                                <label>Email:</label>
                                <input type="email" id="approveEmail" readonly style="background: #f9fafb;">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Contact:</label>
                                <input type="text" id="approveContact" readonly style="background: #f9fafb;">
                            </div>
                            <div class="form-group field-terrain">
                                <label for="approveTerrain">
                                    <span class="label-icon">🏔️</span>
                                    Select Barangay Terrain:
                                </label>
                                <select id="approveTerrain" required>
                                    <option value="" disabled selected>Select terrain type</option>
                                    <option value="Lowland">Lowland</option>
                                    <option value="Highland">Highland</option>
                                </select>
                                <small class="terrain-note">This will be used for all residents in this barangay</small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="approvePassword">Set Default Password:</label>
                                <input type="password" id="approvePassword" required placeholder="Enter default password for this barangay">
                                <small class="terrain-note">The barangay can change this later</small>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="material-icons">check_circle</span>
                                <span>Approve Account</span>
                            </button>
                            <button type="button" onclick="closeApproveModal()" class="cancel-btn">
                                <span class="material-icons">cancel</span>
                                <span>Cancel</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="barangayManagement" class="section hidden">
                <div class="section-header">
                    <h2>Registered Barangays</h2>
                </div>
                <div class="card">
                    <div class="table-container mobile-table">
                        <table id="barangayTable">
                            <thead>
                                <tr>
                                    <th>Barangay</th><th>Total Residents</th><th>Action</th></tr>
                            </thead>
                            <tbody id="barangayTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="residentManagement" class="section hidden">
                <div class="section-header">
                    <h2>Resident Management</h2>
                    <div class="section-actions">
                        <button onclick="showAddResidentModal()" class="action-button primary-btn">
                            <span class="material-icons">add</span>
                            <span class="btn-text">Add Resident</span>
                        </button>
                    </div>
                </div>

                <div class="card">
                    <!-- Search and Export Section matching MSWD design -->
                    <div class="search-filter-section" id="barangayResidentSearchSection">
                        <!-- Export buttons will be moved here by JavaScript -->
                        <div class="search-section">
                            <div class="search-info">
                                <span class="info-icon">ℹ️</span>
                                <span class="info-text">Type to search through all resident information</span>
                            </div>
                            <div class="search-box">
                                <input 
                                    type="text" 
                                    id="barangayResidentSearchInput" 
                                    placeholder="Search residents by name, age, address, or any details..."
                                >
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container mobile-table">
                        <table id="residentsTable">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Age</th>
                                    <th>Address Zone</th>
                                    <th>Household No</th>
                                    <th>Gender</th>
                                    <th>Household Status</th>
                                    <th>House Material</th>
                                    <th>Terrain</th>
                                    <th>Family Members</th>
                                    <th>Monthly Income</th>
                                    <th>Aid History</th>
                                    <th>Remarks</th>
                                    <th>Evacuee History</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="residentsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Modal for Adding Resident -->
            <div id="addResidentModal" class="modal hidden">
                <div class="modal-content add-resident-modal">
                    <div class="modal-header">
                        <h2>Add New Resident</h2>
                        <span class="close" onclick="closeAddResidentModal()">&times;</span>
                    </div>
                    <form id="addResidentForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Name:</label>
                                <input type="text" id="name" required>
                            </div>
                            <div class="form-group">
                                <label for="age">Age:</label>
                                <input type="number" id="age" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="addressZone">Address Zone:</label>
                                <input type="text" id="addressZone" required>
                            </div>
                            <div class="form-group">
                                <label for="householdNumber">Household Number:</label>
                                <input type="text" id="householdNumber" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="gender">Gender:</label>
                                <select id="gender" required>
                                    <option value="" disabled selected>Select gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="householdStatus">Household Status:</label>
                                <select id="householdStatus" required>
                                    <option value="" disabled selected>Select status</option>
                                    <option value="Poor">Poor</option>
                                    <option value="Mid">Mid</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group field-house-material">
                                <label for="houseMaterial">
                                    <span class="label-icon">🏠</span>
                                    House Material:
                                </label>
                                <select id="houseMaterial" required>
                                    <option value="" disabled selected>Select house material</option>
                                    <option value="Concrete">Concrete</option>
                                    <option value="Nipa">Nipa</option>
                                    <option value="Mixed">Mixed</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group field-terrain">
                                <label>
                                    <span class="label-icon">🏔️</span>
                                    Barangay Terrain:
                                </label>
                                <div class="terrain-display" id="barangayTerrainDisplay">
                                    <span class="terrain-badge" id="barangayTerrainBadge">Loading...</span>
                                </div>
                                <small class="terrain-note">Terrain was set by admin when your account was approved</small>
                                <input type="hidden" id="barangayTerrain" name="barangayTerrain">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <label for="student">Student:</label>
                                <input type="checkbox" id="student">
                            </div>
                            <div class="form-group checkbox-group">
                                <label for="working">Working:</label>
                                <input type="checkbox" id="working">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="monthlyIncome">Monthly Income:</label>
                                <input type="number" id="monthlyIncome" placeholder="Enter amount if working only" disabled>
                                <small class="income-note">Enable by checking 'Working' (only for non-students)</small>
                            </div>
                            <div class="form-group">
                                <label for="familyMembers">Family Members:</label>
                                <input type="number" id="familyMembers" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex:1;">
                                <label for="remarks">Remarks:</label>
                                <textarea id="remarks" placeholder="Notes about this person"></textarea>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="aidHistory">Relief Distribution History:</label>
                                <input type="text" id="aidHistory" required placeholder="Number of times received goods">
                            </div>
                            <div class="form-group">
                                <label for="evacueeHistory">Evacuee History:</label>
                                <input type="number" id="evacueeHistory" required placeholder="Times evacuated this year">
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="material-icons">save</span>
                                <span>Submit</span>
                            </button>
                            <button type="button" onclick="closeAddResidentModal()" class="cancel-btn">
                                <span class="material-icons">cancel</span>
                                <span>Cancel</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Modal for Editing Resident -->
            <div id="editResidentModal" class="modal hidden">
                <div class="modal-content add-resident-modal">
                    <div class="modal-header">
                        <h2>Edit Resident</h2>
                        <span class="close" onclick="closeEditResidentModal()">&times;</span>
                    </div>
                    <form id="editResidentForm">
                        <input type="hidden" id="editResidentId">

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editName">Name:</label>
                                <input type="text" id="editName" required>
                            </div>
                            <div class="form-group">
                                <label for="editAge">Age:</label>
                                <input type="number" id="editAge" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editAddressZone">Address Zone:</label>
                                <input type="text" id="editAddressZone" required>
                            </div>
                            <div class="form-group">
                                <label for="editHouseholdNumber">Household Number:</label>
                                <input type="text" id="editHouseholdNumber" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editGender">Gender:</label>
                                <select id="editGender" required>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="editHouseholdStatus">Household Status:</label>
                                <select id="editHouseholdStatus" required>
                                    <option value="Poor">Poor</option>
                                    <option value="Mid">Mid</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editHouseMaterial">House Material:</label>
                                <select id="editHouseMaterial" required>
                                    <option value="Concrete">Concrete</option>
                                    <option value="Nipa">Nipa</option>
                                    <option value="Mixed">Mixed</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group field-terrain">
                                <label>
                                    <span class="label-icon">🏔️</span>
                                    Barangay Terrain:
                                </label>
                                <div class="terrain-display" id="editBarangayTerrainDisplay">
                                    <span class="terrain-badge" id="editBarangayTerrainBadge">Loading...</span>
                                </div>
                                <small class="terrain-note">Terrain was set by admin when your account was approved</small>
                                <input type="hidden" id="editBarangayTerrain" name="editBarangayTerrain">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <label for="editStudent">Student:</label>
                                <input type="checkbox" id="editStudent">
                            </div>
                            <div class="form-group checkbox-group">
                                <label for="editWorking">Working:</label>
                                <input type="checkbox" id="editWorking">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editMonthlyIncome">Monthly Income:</label>
                                <input type="number" id="editMonthlyIncome">
                            </div>
                            <div class="form-group">
                                <label for="editFamilyMembers">Family Members:</label>
                                <input type="number" id="editFamilyMembers" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="editAidHistory">Relief Distribution History:</label>
                                <input type="text" id="editAidHistory" required placeholder="Times received">
                            </div>
                            <div class="form-group">
                                <label for="editEvacueeHistory">Evacuee History:</label>
                                <input type="number" id="editEvacueeHistory" required placeholder="Times evacuated this year">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group" style="flex:1;">
                                <label for="editRemarks">Remarks:</label>
                                <textarea id="editRemarks" placeholder="Notes about this person"></textarea>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="material-icons">update</span>
                                <span>Update</span>
                            </button>
                            <button type="button" onclick="closeEditResidentModal()" class="cancel-btn">
                                <span class="material-icons">cancel</span>
                                <span>Cancel</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div id="statistics" class="section hidden">
                <!-- MSWD Statistics -->
                <div id="mswdStatisticsContainer" class="hidden">
                    <div class="section-header">
                        <h2>Barangay Priority Statistics</h2>
                        <div class="section-actions">
                            <button id="exportBarangayExcelBtn" class="export-btn">
                                <span class="material-icons">download</span>
                                <span class="btn-text">Export Excel</span>
                            </button>
                            <button id="exportBarangayPDFBtn" class="export-btn">
                                <span class="material-icons">picture_as_pdf</span>
                                <span class="btn-text">Export PDF</span>
                            </button>
                            <button id="printBarangayStatsBtn" class="export-btn">
                                <span class="material-icons">print</span>
                                <span class="btn-text">Print</span>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container mobile-chart">
                        <div class="chart-wrapper">
                            <canvas id="barangayPriorityChart"></canvas>
                        </div>
                        <div class="chart-legend" id="barangayLegend"></div>
                    </div>
                    <div id="topBarangaysList" class="priority-list"></div>
                </div>
                
                <!-- Barangay Statistics -->
                <div id="barangayStatisticsContainer" class="hidden">
                    <div class="section-header">
                        <h2>Resident Priority Statistics</h2>
                        <div class="section-actions">
                            <button id="exportResidentExcelBtn" class="export-btn">
                                <span class="material-icons">download</span>
                                <span class="btn-text">Export Excel</span>
                            </button>
                            <button id="exportResidentPDFBtn" class="export-btn">
                                <span class="material-icons">picture_as_pdf</span>
                                <span class="btn-text">Export PDF</span>
                            </button>
                            <button id="printResidentStatsBtn" class="export-btn">
                                <span class="material-icons">print</span>
                                <span class="btn-text">Print</span>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container mobile-chart">
                        <div class="chart-wrapper">
                            <canvas id="residentPriorityChart"></canvas>
                        </div>
                        <div class="chart-legend" id="residentLegend"></div>
                    </div>
                    <div class="priority-lists">
                        <div id="topResidentsList" class="priority-list"></div>
                    </div>
                </div>
            </div>

            <div id="deliveryScheduling" class="section hidden">
                <div class="section-header">
                    <h2>🚚 Delivery Scheduling</h2>
                </div>
                
                <!-- Enhanced Delivery Form Card -->
                <div class="card delivery-form-card">
                    <div class="card-header">
                        <h3>📋 Schedule New Delivery</h3>
                        <p>Create a new delivery schedule for barangay relief distribution</p>
                    </div>
                    
                    <form id="deliveryForm" class="enhanced-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="barangaySelect">Select Barangay</label>
                                <div class="select-wrapper">
                                    <select id="barangaySelect" required>
                                        <option value="" disabled selected>Choose a barangay...</option>
                                    </select>
                                    <span class="select-arrow">▼</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="deliveryDate">Delivery Date</label>
                                <div class="date-wrapper">
                                    <input type="date" id="deliveryDate" required>
                                    <span class="date-icon" style="display:none"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="deliveryDetails">Delivery Details</label>
                            <textarea 
                                id="deliveryDetails" 
                                rows="4" 
                                required 
                                placeholder="Enter delivery details (e.g., Canned goods, rice, water, medical supplies...)"
                            ></textarea>
                        </div>
                        
                        <!-- Enhanced Items Section -->
                        <div class="form-section">
                            <div class="section-header-with-inventory">
                                <h4>Items & Quantities</h4>
                                <div class="inventory-summary" id="inventorySummary" style="font-size: 0.85em; color: #666; margin-top: 4px; display: none;">
                                    <span>📦 Current Inventory: </span>
                                    <span id="currentInventoryDisplay">Loading...</span>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Rice (sacks) <span class="inventory-hint" id="riceInventory"></span></label>
                                    <input type="number" id="goodsRice" min="0" value="0" class="inventory-input" data-item="rice">
                                </div>
                                <div class="form-group">
                                    <label>Biscuits (boxes) <span class="inventory-hint" id="biscuitsInventory"></span></label>
                                    <input type="number" id="goodsBiscuits" min="0" value="0" class="inventory-input" data-item="biscuits">
                                </div>
                                <div class="form-group">
                                    <label>Canned Goods (boxes) <span class="inventory-hint" id="cannedInventory"></span></label>
                                    <input type="number" id="goodsCanned" min="0" value="0" class="inventory-input" data-item="canned">
                                </div>
                                <div class="form-group">
                                    <label>Shirts (packs) <span class="inventory-hint" id="shirtsInventory"></span></label>
                                    <input type="number" id="goodsShirts" min="0" value="0" class="inventory-input" data-item="shirts">
                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="btn-icon" style="display:none"></span>
                                <span>Schedule Delivery</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Enhanced Deliveries Overview Card -->
                <div class="card deliveries-overview-card">
                    <div class="card-header">
                        <h3>📊 Scheduled Deliveries Overview</h3>
                        <p>Manage and track all scheduled deliveries</p>
                    </div>
                    
                    <!-- Search and Filter Section -->
                    <div class="search-filter-section">
                        <div class="search-box">                          >
                            <input 
                                type="text" 
                                id="deliverySearchInput" 
                                placeholder="Search by barangay name, date, or details..."
                            >
                        </div>
                        
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label for="statusFilter">Status:</label>
                                <select id="statusFilter">
                                    <option value="">All Status</option>
                                    <option value="Pending">Pending</option>
                                    <option value="In Transit">In Transit</option>
                                    <option value="Received">Received</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="dateFilter">Date Range:</label>
                                <select id="dateFilter">
                                    <option value="">All Dates</option>
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            
                            
                            <button id="clearFilters" class="clear-filters-btn">
                                <span class="btn-icon">🔄</span>
                                Clear Filters
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container enhanced-table mobile-table">
                        <table id="adminDeliveriesTable">
                            <thead>
                                <tr>
                                    <th>
                                        <span class="th-icon">🏠️</span>
                                        Barangay
                                    </th>
                                    <th>
                                        <span class="th-icon">📅</span>
                                        Date & Time
                                    </th>
                                    <th>
                                        <span class="th-icon">📦</span>
                                        Items & Quantity
                                    </th>
                                    <th>
                                        <span class="th-icon">📏</span>
                                        Details
                                    </th>
                                    <th>
                                        <span class="th-icon">📊</span>
                                        Status
                                    </th>
                                    <th>
                                        <span class="th-icon">⚙️</span>
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="adminDeliveriesTableBody"></tbody>
                        </table>
                        
                        <!-- Empty State -->
                        <div id="noDeliveriesMessage" class="empty-state hidden">
                            <div class="empty-icon">📦</div>
                            <h4>No Deliveries Found</h4>
                            <p>No deliveries match your current search criteria.</p>
                            <button onclick="clearDeliveryFilters()" class="clear-filters-btn">
                                <span class="btn-icon">🔄</span>
                                Clear Filters
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="deliveryStatus" class="section hidden">
                <div class="section-header">
                    <h2>Delivery Status</h2>
                    <div class="section-actions">
                        <button id="viewDeliveryHistoryBtn" class="action-button">
                            <span class="material-icons">history</span>
                            <span class="btn-text">Delivery History</span>
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Scheduled Deliveries</h3>
                    <div class="table-container mobile-table">
                        <table id="barangayDeliveriesTable">
                            <thead>
                                <tr>
                                    <th>
                                        <span class="th-icon">📅</span>
                                        Date & Time
                                    </th>
                                    <th>
                                        <span class="th-icon">📦</span>
                                        Items & Quantity
                                    </th>
                                    <th>
                                        <span class="th-icon">📏</span>
                                        Details
                                    </th>
                                    <th>
                                        <span class="th-icon">📊</span>
                                        Status
                                    </th>
                                    <th>
                                        <span class="th-icon">⚙️</span>
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="deliveriesTableBody"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Delivery History Modal -->
                <div id="deliveryHistoryModal" class="modal hidden">
                    <div class="modal-content" style="max-width: 960px;">
                        <div class="modal-header">
                            <h2>Delivery History</h2>
                            <span class="close" onclick="document.getElementById('deliveryHistoryModal').classList.add('hidden')">&times;</span>
                        </div>
                        <!-- Enhanced Search and Export Section for History -->
                        <div class="search-filter-section" id="historySearchSection">
                            <!-- Export buttons will be moved here by JavaScript -->
                            <div class="search-section">
                                <div class="search-info">
                                    <span class="info-icon">ℹ️</span>
                                    <span class="info-text">Search through delivery history</span>
                                </div>
                                <div class="search-box">
                                    <input 
                                        type="text" 
                                        id="historySearchInput" 
                                        placeholder="Search by date, items, status, notes..."
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <div class="table-container mobile-table">
                            <table id="deliveryHistoryTable">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>Items & Quantity</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Details & Notes</th>
                                        <th>Received At</th>
                                    </tr>
                                </thead>
                                <tbody id="deliveryHistoryBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ✅ Enhanced View Residents Modal -->
            <div id="viewResidentsModal" class="modal hidden">
                <div class="modal-content residents-modal-content">
                    <div class="modal-header">
                        <h2 id="viewResidentsTitle">🏠️ Residents</h2>
                        <div class="modal-actions">
                            <span class="close" onclick="closeViewResidentsModal()">&times;</span>
                        </div>
                    </div>
                    
                    <div class="modal-body">
                        <!-- Export buttons for desktop -->
                        <div class="export-buttons-desktop">
                            <button id="exportResidentsExcelBtn" class="export-btn" title="Export to Excel">
                                <span class="material-icons">download</span>
                                <span class="btn-text">Excel</span>
                            </button>
                            <button id="exportResidentsPDFBtn" class="export-btn" title="Export to PDF">
                                <span class="material-icons">picture_as_pdf</span>
                                <span class="btn-text">PDF</span>
                            </button>
                            <button id="printResidentsBtn" class="export-btn" title="Print">
                                <span class="material-icons">print</span>
                                <span class="btn-text">Print</span>
                            </button>
                        </div>
                        
                        <!-- Export buttons container for mobile (DataTables buttons will be moved here) -->
                        <div class="export-section mobile-export" id="residentsExportSection">
                            <!-- DataTables buttons will be dynamically inserted here -->
                        </div>
                        
                        <div class="search-section">
                            <div class="search-box">
                                <input 
                                    type="text" 
                                    id="residentSearchInput" 
                                    placeholder="Search residents by name, age, address, or any details..."
                                >
                            </div>
                            <div class="search-info">
                                <span class="info-icon">ℹ️</span>
                                <span class="info-text">Type to search through all resident information</span>
                            </div>
                            
                        </div>
                        
                        <div class="table-container enhanced-residents-table">
                            <div class="table-wrapper">
                                <table id="viewResidentsTable">
                                    <thead>
                                        <tr>
                                            <th class="name-col">Name</th>
                                            <th class="age-col">Age</th>
                                            <th class="address-col">Address Zone</th>
                                            <th class="household-col">Household No</th>
                                            <th class="gender-col">Gender</th>
                                            <th class="status-col">Household Status</th>
                                            <th class="house-col">House Material</th>
                                            <th class="terrain-col">Terrain</th>
                                            <th class="family-col">Family Members</th>
                                            <th class="income-col">Monthly Income</th>
                                            <th class="aid-col">Aid History</th>
                                            <th class="remarks-col">Remarks</th>
                                            <th class="evacuee-col">Evacuee History</th>
                                            <th class="status-col">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="viewResidentsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Change Password Modal -->
            <div id="changePasswordModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Change Password</h2>
                    </div>
                    <form id="changePasswordForm">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" required placeholder="Enter your current password">
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" required placeholder="Enter your new password">
                            <div class="password-strength">
                                <span class="password-strength-text">Password strength</span>
                                <div class="password-strength-bar">
                                    <div class="password-strength-fill"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmNewPassword">Confirm New Password</label>
                            <input type="password" id="confirmNewPassword" required placeholder="Confirm your new password">
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">
                                <span class="material-icons">lock_reset</span>
                                <span>Update Password</span>
                            </button>
                            <button type="button" onclick="closeChangePasswordModal()" class="cancel-btn">
                                <span class="material-icons">cancel</span>
                                <span>Cancel</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables & dependencies -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    <script type="module" src="./firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="chart.js"></script>
    <!-- SweetAlert2 for beautiful login popups -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="module" src="app.js"></script>
    <script src="statistics.js"></script>

    <!-- ✅ Global Message Modal -->
    <div id="messageModal" class="modal hidden">
        <div class="modal-content" style="text-align:center;">
            <h2 id="messageTitle">Message</h2>
            <p id="messageText"></p>
            <button id="messageOkBtn" onclick="closeMessageModal()">OK</button>
        </div>
    </div>

    <!-- Global Functions Script (loaded immediately) -->
    <script>
        // Global functions that need to be available immediately for onclick handlers
        
        // Modal functions
        function closeEditResidentModal() {
            const modal = document.getElementById("editResidentModal");
            if (modal) {
                modal.classList.add("hidden");
                modal.style.display = "none";
                modal.style.visibility = "hidden";
                modal.style.opacity = "0";
                modal.style.pointerEvents = "none";
                
                // Reset form
                const form = document.getElementById("editResidentForm");
                if (form) {
                    form.reset();
                }
                
                // Clear validation states
                const inputs = modal.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.classList.remove('error', 'success');
                    input.style.borderColor = '';
                });
            }
        }
        
        function closeAddResidentModal() {
            const modal = document.getElementById("addResidentModal");
            if (modal) {
                modal.classList.add("hidden");
                modal.style.display = "none";
                modal.style.visibility = "hidden";
                modal.style.opacity = "0";
                modal.style.pointerEvents = "none";
                
                // Reset form
                const form = document.getElementById("addResidentForm");
                if (form) {
                    form.reset();
                }
                
                // Clear validation states
                const inputs = modal.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    input.classList.remove('error', 'success');
                    input.style.borderColor = '';
                });
            }
        }
        
        function showAddResidentModal() {
            const modal = document.getElementById("addResidentModal");
            if (modal) {
                modal.classList.remove("hidden");
                modal.style.display = "flex";
                modal.style.visibility = "visible";
                modal.style.opacity = "1";
                modal.style.pointerEvents = "auto";
            }
        }
        
        function showEditResidentModal() {
            const modal = document.getElementById("editResidentModal");
            if (modal) {
                modal.classList.remove("hidden");
                modal.style.display = "flex";
                modal.style.visibility = "visible";
                modal.style.opacity = "1";
                modal.style.pointerEvents = "auto";
            }
        }
        
        function closeApproveModal() {
            const modal = document.getElementById('approveAccountModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
                modal.style.visibility = 'hidden';
                modal.style.opacity = '0';
                modal.style.pointerEvents = 'none';
                
                // Clear form
                const form = document.getElementById('approveAccountForm');
                if (form) form.reset();
            }
        }
        
        function closeChangePasswordModal() {
            const modal = document.getElementById("changePasswordModal");
            if (modal) {
                modal.classList.add("hidden");
                modal.style.display = "none";
                modal.style.visibility = "hidden";
                modal.style.opacity = "0";
                modal.style.pointerEvents = "none";
                
                // Reset form
                const form = document.getElementById("changePasswordForm");
                if (form) {
                    form.reset();
                }
            }
        }
        
        function closeViewResidentsModal() {
            const modal = document.getElementById('viewResidentsModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.style.display = 'none';
            }
        }
        
        // Navigation function
        function showSection(sectionId) {
            console.log('Switching to section:', sectionId);
            
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.add('hidden');
                sec.style.display = 'none';
            });
            
            // Show target section
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.remove('hidden');
                target.style.display = 'block';
            }
            
            // Close mobile sidebar if open
            if (window.innerWidth <= 768) {
                closeMobileSidebar();
            }
        }
        
        // Utility functions
        function editResident(id) {
            console.log('Edit resident:', id);
            // Implementation will be handled by the module
        }
        
        function deleteResident(id) {
            if (confirm('Are you sure you want to delete this resident?')) {
                console.log('Delete resident:', id);
                alert('Delete functionality will be implemented.');
            }
        }
        
        function viewBarangay(id, name) {
            console.log('View barangay:', id, name);
            // Implementation will be handled by the module
        }
        
        function toggleBarangayDeliveryDetails(deliveryId) {
            const detailsRow = document.getElementById(`barangay-details-row-${deliveryId}`);
            if (detailsRow) {
                detailsRow.classList.toggle('hidden');
            }
        }
        
        function printBarangayDeliveryReceipt(deliveryId, deliveryData) {
            console.log('Print receipt for:', deliveryId, deliveryData);
            alert('Print functionality will be implemented.');
        }
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // This will be handled by the module, but provide basic fallback
                window.location.reload();
            }
        }
        
        // Change password function  
        function showChangePassword() {
            const modal = document.getElementById("changePasswordModal");
            if (modal) {
                modal.classList.remove("hidden");
                modal.style.display = "flex";
                modal.style.visibility = "visible";
                modal.style.opacity = "1";
                modal.style.pointerEvents = "auto";
            }
        }
        
        // Message modal functions
        function closeMessageModal() {
            const modal = document.getElementById("messageModal");
            if (!modal) return;
            
            // Add hide animation
            modal.classList.add("hide");
            modal.classList.remove("show");
            
            // Hide after animation completes
            setTimeout(() => {
                modal.classList.add("hidden");
                modal.classList.remove('success', 'error', 'warning', 'info', 'hide');
            }, 300);
        }
        
        console.log('✅ Global functions loaded and available');
        
        // Comprehensive live reload error handling
        
        // Defensive refreshCSS function to prevent live reload errors
        function refreshCSS() {
            try {
                const links = document.getElementsByTagName('link');
                for (let i = links.length - 1; i >= 0; i--) {
                    const link = links[i];
                    if (link.rel === 'stylesheet' && link.href) {
                        // Check if the link is actually in the document
                        if (link.parentNode && document.contains(link)) {
                            const newLink = document.createElement('link');
                            newLink.rel = 'stylesheet';
                            newLink.type = 'text/css';
                            newLink.href = link.href + '?t=' + Date.now();
                            
                            // Insert the new link and remove the old one safely
                            link.parentNode.insertBefore(newLink, link.nextSibling);
                            
                            // Use a timeout to ensure the new CSS is loaded
                            setTimeout(() => {
                                if (link.parentNode && document.contains(link)) {
                                    link.parentNode.removeChild(link);
                                }
                            }, 100);
                        }
                    }
                }
            } catch (error) {
                console.warn('CSS refresh error (can be safely ignored):', error.message);
            }
        }
        
        // Prevent other common live reload errors
        window.addEventListener('error', function(event) {
            if (event.message && event.message.includes('removeChild')) {
                console.warn('Live reload DOM error (can be safely ignored):', event.message);
                event.preventDefault();
                return true;
            }
        });
        
        // Handle WebSocket connection errors gracefully
        const originalWebSocket = window.WebSocket;
        if (originalWebSocket) {
            window.WebSocket = function(url, protocols) {
                const ws = new originalWebSocket(url, protocols);
                ws.addEventListener('error', function(event) {
                    console.warn('WebSocket connection error (likely live reload server):', event);
                });
                return ws;
            };
            // Copy static properties
            Object.setPrototypeOf(window.WebSocket, originalWebSocket);
            window.WebSocket.prototype = originalWebSocket.prototype;
        }
    </script>
    
    <!-- Mobile Navigation Script -->
    <script>
        // Mobile sidebar functionality
        function toggleMobileSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
            
            // Prevent body scrolling when sidebar is open
            if (sidebar.classList.contains('mobile-open')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (!sidebar.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                if (sidebar.classList.contains('mobile-open')) {
                    closeMobileSidebar();
                }
            }
        });

        // Close sidebar when clicking on a navigation link
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    closeMobileSidebar();
                }
            });
        });
    </script>
</body>
</html>